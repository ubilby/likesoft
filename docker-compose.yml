version: '3.6' 
  
volumes: 
  books_msql_data: 
  
services: 
  database: 
    env_file: .env 
    image: mysql:5.7
    volumes: 
     - books_msql_data:/var/lib/mysql
  
  django_api: 
    env_file: .env 
    build: ./backend/ 
    depends_on: 
     - database 
    ports: 
     - 8000:8000
    # volumes:
    #  - ./backend/:/backend
    command: gunicorn --bind 0.0.0.0 backend.wsgi

  redis:
    image: redis:7.2.3-alpine3.18
    hostname: redis

  worker:
    env_file: .env 
    build: ./backend/
    hostname: worker
    # volumes:
    #   - ./backend/:/backend
    links:
      - redis
    depends_on:
      - django_api
      - redis
    command: celery -A backend worker -l info
